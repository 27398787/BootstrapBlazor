export function bb_barcode_init(t,i){const r=document.querySelector(t);n[t]={codeReader:new ZXing.BrowserMultiFormatReader,element:r,scanType:r.getAttribute("data-bb-scan")};let u=n[t];const f=u.codeReader;if(u.scanType==="Camera"){const e=()=>{i.invokeMethodAsync("Start");const n=r.getAttribute("data-bb-deviceId"),t=r.querySelector("video").getAttribute("id");f.decodeFromVideoDevice(n,t,(n,t)=>{n&&(bb.Utility.vibrate(),console.log(n.text),i.invokeMethodAsync("GetResult",n.text),u.autoStop&&f.reset()),!t||t instanceof ZXing.NotFoundException||(console.error(t),i.invokeMethodAsync("GetError",t))})},o=()=>{f.reset(),i.invokeMethodAsync("Stop")};n[t]={...n[t],...{autoStart:r.getAttribute("data-bb-autostart")==="true",autoStop:r.getAttribute("data-bb-autostop")==="true",scanButton:r.querySelector('[data-bb-method="scan"]'),scan:e,stop:o}};u=n[t];f.getVideoInputDevices().then(n=>{i.invokeMethodAsync("InitDevices",n).then(()=>{u.autoStart&&n.length>0&&u.scanButton.click()})})}else{const e=()=>{const n=u.file.files;if(n.length!==0){const t=new FileReader;t.onloadend=function(n){f.decodeFromImageUrl(n.target.result).then(n=>{n&&(bb.Utility.vibrate(),console.log(n.text),i.invokeMethodAsync("GetResult",n.text))}).catch(n=>{n&&(console.log(n),i.invokeMethodAsync("GetError",n.message))})};t.readAsDataURL(n[0])}},o=()=>{let n=r.querySelector('[type="file"]');n&&(bootstrap.EventHandler.off(n,"change",e),n.remove());n=document.createElement("input");n.setAttribute("type","file");n.setAttribute("hidden","true");n.setAttribute("accept","image/*");r.append(n);bootstrap.EventHandler.on(n,"change",e);return u.file=n,n},s=()=>{let n=o();n.click()};n[t]={...n[t],...{scanImage:s}};u=n[t]}f.eventHandler=()=>{let n=event.target;if(n.hasAttribute("[data-bb-method]")||(n=n.closest("[data-bb-method]")),n){const i=n.getAttribute("data-bb-method"),t=u[i];typeof t=="function"&&t()}};bootstrap.EventHandler.on(r,"click","[data-bb-method]",f.eventHandler)}export function bb_barcode_dispose(t){const i=n[t];if(i){const r=i.codeReader;r!=null&&(bootstrap.EventHandler.off(r.el,"click","[data-bb-method]",r.eventHandler),r.reset());delete n[t]}}const n={};